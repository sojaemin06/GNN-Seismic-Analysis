# GNN 기반 RC 모멘트 골조 푸쉬오버 곡선 예측 모델 개발

## 1. 프로젝트 개요

### 1.1. 최종 목표
- Graph Neural Network(GNN)를 활용하여 저층 RC **모멘트 골조** 구조물의 비선형 정적해석(푸쉬오버 해석) 결과인 **푸쉬오버 곡선(Pushover Curve)을 신속하게 예측**하는 딥러닝 모델을 개발한다.
- 최종 연구 결과는 **SCI급 해외 학술지 게재**를 목표로 한다.

### 1.2. 연구 범위
- 본 프로젝트는 비선형 정적해석의 이론적 가정을 만족하는 **1차 모드 지배 RC 모멘트 골조 시스템**을 대상으로 한다. 이를 통해 데이터의 일관성을 확보하고 GNN 모델의 예측 성능을 명확하게 평가한다.

---

## 2. 기술 명세

### 2.1. 구조 해석 엔진
- 해석 엔진으로 **OpenSeesPy**를 사용한다.
- `src/core/` 디렉토리 내의 모듈들이 구조 모델링, 해석 실행, 결과 후처리를 담당한다.

### 2.2. 구조 모델링 및 데이터 검증
- **재료 강도:** '내진성능 평가요령'에 따라 공칭강도가 아닌 **기대강도**를 사용하여 부재 강도를 산정한다.
- **데이터 유효성 검증:** 생성되는 모든 구조물 데이터는 다음 조건을 만족해야 한다.
    1.  **1차 모드 지배 조건:** 다중모드 스펙트럼 해석(RSA)과 1차 모드 RSA의 층전단력 차이가 130%를 초과하지 않아야 한다. (`src/core/verification.py`)
    2.  **질량 참여율:** 해석 방향의 유효 질량 참여율이 90% 이상이어야 한다.
- **부재 속성 샘플링 전략:** 데이터셋의 현실성과 다양성을 확보하기 위해 다음 전략을 따른다.
    1.  **경간 거리:** X, Z 방향 경간 거리를 랜덤 샘플링한다.
    2.  **재료 균일성:** 한 건물 내 모든 부재의 콘크리트 압축강도(fc), 철근 항복강도(Fy), 철근 단면적(rebar_Area)은 동일하게 적용한다.
    3.  **그룹화:** 기둥과 보는 2개 층 단위로 그룹화하며, 상부 그룹은 하부 그룹보다 단면 크기가 같거나 작게 설정된다.
    4.  **기둥 단면:** 각 그룹 내에서 '내부(Interior)'와 '외부(Exterior)'로 그룹을 나누고, `내부 기둥 단면 ≥ 외부 기둥 단면` 규칙을 만족하는 범위 내에서 샘플링한다.
    5.  **보 단면:** 각 그룹 내에서 '내부(Interior)'와 '외부(Exterior)'로 그룹을 나누어 샘플링한다.
    6.  **강한 기둥-약한 보(SCWB) 규칙:** 각 그룹의 기둥 단면 후보군은 보 단면 후보군보다 항상 강한 단면들로 구성하여, 샘플링 단계에서부터 SCWB 규칙이 자연스럽게 만족되도록 한다.

### 2.3. GNN 그래프 데이터 구조
- **그래프 표현:** 구조물은 **'절점(Joint) = 노드(Node), 부재(Member) = 엣지(Edge)'** 방식으로 표현한다.
- **전역 특성 (Global Feature):** `[is_X_dir, is_Z_dir]`
    - 해석 방향을 나타내는 2차원 벡터 (예: X방향 `[1, 0]`, Z방향 `[0, 1]`). **단일 GNN 모델이 양방향 예측을 모두 수행**하기 위해 사용된다.
- **노드 특성 (Node Features):** `[x_coord, y_coord, z_coord, is_base_node]`
    - 3차원 좌표와 지지점(y=0) 여부를 나타내는 4차원 벡터.
- **엣지 특성 (Edge Features):** `[is_column, is_beam, width, depth, fc, Fy, ...]`
    - 부재 종류, 단면 크기, 재료 강도, 철근 상세 등 부재의 물리적 정보를 포함하는 고차원 벡터.
- **타겟 데이터 (Target Data):**
    - 표준화된 100개 지점에서의 **푸쉬오버 곡선**(변위-하중 관계).

---

## 3. 프로젝트 구조

본 프로젝트는 코드의 역할과 책임을 명확히 분리하기 위해 다음 구조를 따른다.

```
GNN_Project/
├── data/                # 생성된 데이터셋 저장 (raw, processed)
├── results/             # 해석 결과, 모델 출력, 플롯 등 저장
├── scripts/             # 데이터 생성, 모델 학습 등 실행 스크립트
│   ├── generate_dataset.py
│   └── run_single_analysis.py
├── src/                 # 모든 파이썬 소스 코드
│   ├── core/            # 구조 해석(모델링, 해석, 후처리) 핵심 로직
│   ├── data/            # 데이터 처리 및 그래프 변환 관련 모듈
│   ├── gnn/             # GNN 모델, 학습/평가 로직
│   └── visualization/   # 시각화 관련 모듈
├── PROJECT_SUMMARY.md   # 프로젝트 요약 (본 파일)
└── requirements.txt     # 필요 라이브러리
```

---

## 4. 프로젝트 완수를 위한 세부 달성 목표

프로젝트 완수를 위해 다음 3단계의 목표를 순차적으로 달성해야 한다.

### 목표 1: 학습 데이터셋 생성
- **내용:** `scripts/generate_dataset.py` 스크립트를 실행한다. 이 스크립트는 **2.2절에 정의된 상세 샘플링 전략(2층 그룹화, 위치 기반 부재 크기 설정, SCWB 규칙 등)**에 따라 다양한 파라미터를 조합하여 RC 모멘트 골조 모델에 대한 대규모 데이터셋을 생성한다.
- **산출물:**
    1.  각 모델의 그래프 구조와 푸쉬오버 곡선이 저장된 PyTorch Geometric 데이터 파일 (`.pt`) 묶음. (`data/processed/` 경로에 저장)
    2.  생성된 전체 데이터셋의 정보를 요약한 `dataset_summary.csv` 파일.

### 목표 2: GNN 모델 구현 및 학습
- **내용:** `src/gnn/` 디렉토리 내에 단일 GNN 모델과 학습 파이프라인을 구현한다.
- **세부 과업:**
    1.  **모델 정의 (`src/gnn/models.py`):** 엣지 특성과 **전역 방향 특성을 함께 처리**하여 방향에 따른 조건부 예측을 수행할 수 있는 GNN 아키텍처(예: GAT, MessagePassing 기반 모델)를 설계한다.
    2.  **학습 파이프라인 구현 (`src/gnn/train.py`):** 데이터셋 로딩, 모델 학습/검증/테스트, 손실 함수 계산, 결과 로깅을 포함하는 전체 과정을 구현한다.

### 목표 3: 모델 성능 평가 및 분석
- **내용:** 학습된 GNN 모델의 예측 성능을 공학적으로 의미 있는 지표를 통해 정량적으로 평가한다.
- **세부 과업:**
    1.  **성능점 산정 기능 활용:** `src/core/post_processor.py`의 역량스펙트럼법(CSM) 기능을 사용하여, GNN이 예측한 푸쉬오버 곡선으로부터 성능점을 계산한다.
    2.  **오차 분석:** 예측된 성능점과 실제 해석 결과의 성능점을 비교하여 모델의 정확도와 신뢰성을 평가하고, SCI급 논문 작성을 위한 기반 자료를 확보한다.

---

## 5. CLI 에이전트를 위한 개발 가이드

향후 CLI 에이전트가 본 프로젝트의 개발을 진행할 때, 다음 가이드라인을 준수해야 한다.

- **코드 수정:** 모든 핵심 로직은 `src` 디렉토리 내에 위치한다. 구조 해석 로직은 `src/core/`, GNN 모델 로직은 `src/gnn/` 에서 수정한다.
- **스크립트 실행:** 데이터셋 생성, 모델 학습 등의 작업은 `scripts` 디렉토리의 스크립트를 통해 실행한다. **모든 스크립트는 프로젝트 최상위 디렉토리(`GNN_Project/`)에서 실행** (예: `python scripts/generate_dataset.py`)하는 것을 원칙으로 한다.
- **데이터 및 결과물 관리:** 생성된 데이터는 `data/`, 결과물은 `results/` 디렉토리에 저장하여 관리한다.
- **의존성 관리:** 새로운 외부 라이브러리를 사용할 경우, `requirements.txt`에 추가하여 관리한다.
